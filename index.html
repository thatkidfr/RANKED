<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranked Spikeball</title>
</head>
<body>
    <h1>RANKED SPIKEBALL - SEASON 1</h1>
    <button onclick="rankedMatch2v2();">RANKED MATCH 2v2</button>
    <button onclick="rankedMatch1v1();">RANKED MATCH 1v1</button>
    <br>
    <button onclick="addPlayer();saveData();">ADD PLAYER</button>
    <h3>---PLAYERS---<br><span id="players"></span></h3>
    <button onclick="resetData();">RESET</button>
    <button onclick="alert(users);">debug</button>


    <script>
        function saveData(){
            localStorage.setItem("DATA", JSON.stringify(users));
        }
        function resetData(){

            if (!confirm("ARE YOU SURE YOU WANT TO RESET?")){
                return;
            }
            if (!confirm("FINAL WARNING")){return;}
            localStorage.setItem("DATA", JSON.stringify([]));
            users = [];
            updatePlayerText();
        }
        
        // Where player 1 is the winner
        function calculateElo(player1Elo, player2Elo, K){
            let e1 = 1 / (1 + 10**((player2Elo-player1Elo)/400));
            let e2 = 1 / (1 + 10**((player1Elo-player2Elo)/400));

            let finalP1Elo = player1Elo + Math.round(K*(1-e1));
            let finalP2Elo = player2Elo + Math.round(K*(0-e2));

            if (finalP2Elo < 0){
                finalP2Elo = 0;
            }

            return [finalP1Elo, finalP2Elo];
            
        }


        function rankedMatch1v1(){
            let person1 = parseInt(prompt("Player ID of winner"));
            let person2 = parseInt(prompt("Player ID of loser"));

            let elo1 = users[person1][2];
            let elo2 = users[person2][2];

            let finalElo = calculateElo(elo1, elo2, seasonMaxElo);

            users[person1][2] = finalElo[0];
            users[person2][2] = finalElo[1];

            saveData();
            updatePlayerText();
        }


        function rankedMatch2v2(){
            alert();
        }
        
        
        function addPlayer(){
            playerName = prompt("Enter Name");
            playerId = users.length;
            playerElo1v1 = 1000;
            playerElo2v2 = 1000;
            if (playerName !== null){
                users.push([playerName, playerId, playerElo1v1, playerElo2v2]);
                updatePlayerText();
            }
            
            
        }
        function updatePlayerText(){
            let playerTEXT = document.getElementById("players");


            let playerList = users.map(user => 
      `${user[1]} - ${user[0]} - 1v1 Elo: ${user[2]} - 2v2 Elo: ${user[3]}`
    ).join("<br>");
    
    playerTEXT.innerHTML = playerList;
        }


        let seasonMaxElo = 100;
        let users = [];
        if (localStorage.getItem('DATA') !== null) {
            users = JSON.parse(localStorage.getItem("DATA"));
        } else {
            users = [];
            localStorage.setItem('DATA', JSON.stringify(users));
        }
        updatePlayerText();
        
    </script>
</body>
</html>
